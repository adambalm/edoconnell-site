---
/**
 * RelatedReading — bidirectional bridge between key articles.
 *
 * Hardcoded mapping for now — only two articles to cross-link.
 * If content grows, this becomes a Sanity reference field.
 */

interface RelatedArticle {
  label: string
  description: string
  title: string
  href: string
  kind: string
}

interface Props {
  currentSlug: string
}

const { currentSlug } = Astro.props

const bridges: Record<string, RelatedArticle> = {
  'solution-architecture-brief': {
    label: 'From the Bike Shop',
    description:
      'This brief applies a method learned in a bike shop — that complex systems require not just technical competence but the attention to true them.',
    title: 'The Bike Shop',
    href: '/articles/the-bike-shop/',
    kind: 'essay',
  },
  'the-bike-shop': {
    label: 'From the Workbench',
    description:
      'The ideas in this essay shape my professional work with content systems and AI.',
    title: 'Solution Architecture Brief: Content Operations + AI Readiness',
    href: '/articles/solution-architecture-brief/',
    kind: 'brief',
  },
}

const related = bridges[currentSlug]
const showExit = currentSlug === 'the-bike-shop'
---

{related && (
  <aside class="related-reading" aria-label="Related reading">
    <h2 class="related-heading">Related</h2>
    <a href={related.href} class="related-card" data-kind={related.kind}>
      <span class="related-label">{related.label}</span>
      <p class="related-description">{related.description}</p>
      <span class="related-title">
        {related.title} <span aria-hidden="true">&rarr;</span>
      </span>
    </a>
    {showExit && (
      <a href="/articles/" class="exit-link">
        <span aria-hidden="true">&larr;</span> Take me back to sanity
      </a>
    )}
  </aside>
)}

<style>
  .related-reading {
    margin-top: var(--space-16, 4rem);
    padding-top: var(--space-8, 2rem);
    border-top: 1px solid var(--color-border);
  }

  .related-heading {
    font-family: var(--font-ui);
    font-size: var(--font-size-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
    margin-bottom: var(--space-4, 1rem);
  }

  .related-card {
    display: block;
    text-decoration: none;
    color: inherit;
    padding: var(--space-4, 1rem) var(--space-6, 1.5rem);
    border-left: 3px solid var(--color-border);
    border-radius: 0 4px 4px 0;
    transition: border-color 0.2s ease, background-color 0.2s ease;
  }

  .related-card:hover {
    background: var(--color-bg-subtle);
  }

  .related-card[data-kind="brief"] {
    border-left-color: var(--color-kind-brief);
  }

  .related-card[data-kind="essay"] {
    border-left-color: var(--color-kind-essay);
  }

  .related-card[data-kind="case-study"] {
    border-left-color: var(--color-kind-case-study);
  }

  .related-label {
    display: block;
    font-family: var(--font-ui);
    font-size: var(--font-size-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--space-2, 0.5rem);
  }

  .related-card[data-kind="brief"] .related-label {
    color: var(--color-kind-brief);
  }

  .related-card[data-kind="essay"] .related-label {
    color: var(--color-kind-essay);
  }

  .related-card[data-kind="case-study"] .related-label {
    color: var(--color-kind-case-study);
  }

  .related-description {
    font-family: var(--font-prose);
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    line-height: var(--leading-normal);
    margin: 0 0 var(--space-3, 0.75rem) 0;
    max-width: var(--measure);
  }

  .related-title {
    display: block;
    font-family: var(--font-ui);
    font-size: var(--font-size-base);
    font-weight: 500;
    color: var(--color-text);
  }

  .related-card:hover .related-title {
    color: var(--color-accent);
  }

  .exit-link {
    display: inline-block;
    margin-top: var(--space-6, 1.5rem);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .exit-link:hover {
    color: var(--color-accent);
  }
</style>
