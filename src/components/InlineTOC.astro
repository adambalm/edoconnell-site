---
/**
 * InlineTOC â€” inline table of contents for article pages.
 *
 * Receives pre-extracted headings (computed in the page template before
 * PortableText mutates the body array). Horizontal layout with dot
 * separators. Only renders when 3+ headings are provided.
 */

interface Heading {
  text: string
  id: string
}

interface Props {
  headings: Heading[]
}

const { headings } = Astro.props
---

{headings.length >= 3 && (
  <nav class="inline-toc" aria-label="Table of contents">
    <ol>
      {headings.map((heading, i) => (
        <li>
          {i > 0 && <span class="toc-sep" aria-hidden="true">&middot;</span>}
          <a href={`#${heading.id}`}>{heading.text}</a>
        </li>
      ))}
    </ol>
  </nav>
)}

<script>
  document.querySelectorAll('.inline-toc a[href^="#"]').forEach(link => {
    link.addEventListener('click', (e) => {
      const id = link.getAttribute('href')?.slice(1);
      const target = id && document.getElementById(id);
      if (target) {
        e.preventDefault();
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        target.scrollIntoView({ behavior: prefersReduced ? 'instant' : 'smooth', block: 'start' });
        history.pushState(null, '', `#${id}`);
      }
    });
  });
</script>

<style>
  .inline-toc {
    margin-bottom: var(--space-8);
    padding: var(--space-4) 0;
    border-bottom: 1px solid var(--color-border);
  }

  .inline-toc ol {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-1);
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .inline-toc li {
    display: flex;
    align-items: center;
    gap: var(--space-1);
  }

  .toc-sep {
    color: var(--color-text-muted);
    font-size: var(--font-size-sm);
    user-select: none;
  }

  .inline-toc a {
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    text-decoration: none;
  }

  .inline-toc a:hover {
    color: var(--color-accent);
  }
</style>
