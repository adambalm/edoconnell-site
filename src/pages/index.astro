---
import BaseLayout from '../layouts/BaseLayout.astro'
import { loadQuery } from '../sanity/lib/load-query'
import { PortableText } from 'astro-portabletext'

let page = { title: "Ed O'Connell", subtitle: "Cognition in context.", body: null as any[] | null, seo: null as any }
try {
  const { data } = await loadQuery<typeof page>({
    query: `*[_id == "page-home"][0]{ title, subtitle, body, seo { metaTitle, metaDescription, ogImage { asset->{ url } } } }`,
  })
  if (data) page = data
} catch {
  // Sanity unreachable â€” use hardcoded fallbacks
}

const metaDescription = page.seo?.metaDescription
const ogImage = page.seo?.ogImage?.asset?.url
---

<BaseLayout title="Home" description={metaDescription} ogImage={ogImage}>
  <section aria-labelledby="intro-heading">
    <h1 id="intro-heading">{page.title}</h1>
    {page.subtitle && <p class="subtitle">{page.subtitle}</p>}

    {page.body && (
      <div class="body">
        <PortableText value={page.body} />
      </div>
    )}
  </section>
</BaseLayout>

<style>
  .subtitle {
    color: var(--color-text-muted);
    font-size: var(--font-size-lg);
    margin-top: 0;
  }

  .body {
    margin-top: var(--space-8);
    line-height: 1.7;
  }
</style>
