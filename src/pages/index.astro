---
export const prerender = true

import BaseLayout from '../layouts/BaseLayout.astro'
import { loadQuery } from '../sanity/lib/load-query'
import { PortableText } from 'astro-portabletext'

let page = { title: "Ed O'Connell", subtitle: "Cognition in context.", body: null as any[] | null, seo: null as any }
try {
  const { data } = await loadQuery<typeof page>({
    query: `*[_id == "page-home"][0]{ title, subtitle, body, seo { metaTitle, metaDescription, ogImage { asset->{ url } } } }`,
  })
  if (data) page = data
} catch (e) {
  console.warn('[index] Sanity fetch failed â€” using fallback content:', e instanceof Error ? e.message : e)
}

const metaDescription = page.seo?.metaDescription
const ogImage = page.seo?.ogImage?.asset?.url
---

<BaseLayout title="Home" description={metaDescription} ogImage={ogImage}>
  <section aria-labelledby="intro-heading">
    <h1 id="intro-heading">{page.title}</h1>
    {page.subtitle && <p class="subtitle">{page.subtitle}</p>}

    <nav class="home-nav" aria-label="Quick navigation">
      <a href="/articles/">Articles</a>
      <span class="nav-sep" aria-hidden="true">&middot;</span>
      <a href="/demos/">Demos</a>
      <span class="nav-sep" aria-hidden="true">&middot;</span>
      <a href="https://docs.google.com/document/d/1cg4dNgaOKsrBFPWAu0qFEQE8c7FgcT5R/preview" target="_blank" rel="noopener">Resume</a>
    </nav>

    {page.body && (
      <div class="body">
        <PortableText value={page.body} />
      </div>
    )}
  </section>
</BaseLayout>

<style>
  .subtitle {
    color: var(--color-text-muted);
    font-family: var(--font-ui);
    font-size: var(--font-size-lg);
    margin-top: var(--space-2);
  }

  .home-nav {
    margin-top: var(--space-6);
    font-family: var(--font-ui);
    font-size: var(--font-size-sm);
  }

  .home-nav a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .home-nav a:hover {
    color: var(--color-accent);
  }

  .nav-sep {
    margin: 0 var(--space-2);
    color: var(--color-text-muted);
  }

  .body {
    margin-top: var(--space-12);
    line-height: 1.7;
  }
</style>
