---
export const prerender = true

import BaseLayout from '../../layouts/BaseLayout.astro'
import ArticleCard from '../../components/ArticleCard.astro'
import { loadQuery } from '../../sanity/lib/load-query'

interface ArticleListing {
  _id: string
  title: string
  slug: { current: string }
  kind?: string
  subtitle?: string
  abstract?: string
  tags?: string[]
  provenance?: { date?: string }
}

let articles: ArticleListing[] = []
try {
  const result = await loadQuery<ArticleListing[]>({
    query: `*[_type == "article" && defined(slug.current)] | order(title asc) {
      _id,
      title,
      slug,
      kind,
      subtitle,
      abstract,
      tags,
      provenance { date }
    }`,
  })
  if (result.data) articles = result.data
} catch (e) {
  console.warn('[articles] Sanity fetch failed:', e instanceof Error ? e.message : e)
}
---

<BaseLayout title="Articles">
  <section aria-labelledby="articles-heading">
    <h1 id="articles-heading">Articles</h1>

    {(!articles || articles.length === 0) ? (
      <p class="empty">No articles published yet.</p>
    ) : (
      <div class="article-grid">
        {articles.map((article) => (
          <ArticleCard article={article} />
        ))}
      </div>
    )}
  </section>
</BaseLayout>

<style>
  .article-grid {
    display: grid;
    gap: var(--space-6);
    margin-top: var(--space-8);
  }

  .empty {
    color: var(--color-text-muted);
    font-style: italic;
    margin-top: var(--space-8);
  }
</style>
